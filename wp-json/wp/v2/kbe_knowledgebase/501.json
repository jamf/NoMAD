{"id":501,"date":"2016-12-20T22:18:11","date_gmt":"2016-12-20T22:18:11","guid":{"rendered":"http:\/\/gonomad.wpengine.com\/?post_type=kbe_knowledgebase&#038;p=113"},"modified":"2018-06-19T09:20:27","modified_gmt":"2018-06-19T14:20:27","slug":"security-in-nomad","status":"publish","type":"kbe_knowledgebase","link":"https:\/\/nomad.menu\/help\/security-in-nomad\/","title":{"rendered":"Security in NoMAD"},"content":{"rendered":"<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">As an application dealing with passwords and certificates, NoMAD takes security very seriously. Here are some notes to give you a better understanding of what NoMAD does with your secrets.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">General Thoughts<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">NoMAD itself doesn&#8217;t do any of the heavy lifting as far as signing in to Active Directory and getting you SSO access. The interaction with AD is all done via Kerberos and LDAP, Heimdal Kerberos, and OpenLDAP. NoMAD uses the versions of those tools that ship with macOS.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Source Available<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">Since NoMAD is an open source project, all of the source code used for it is publicly <a href=\"https:\/\/gitlab.com\/mactroll\/nomad\">available<\/a>. You are more than welcome to inspect the source, run it through a security scanner, or otherwise ensure that we&#8217;re doing things in the proper way.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">Please let us know if you have any concerns about particular lines of code\u2014 we want to make sure that NoMAD is just as secure as we say it is.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Passwords<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">While most of NoMAD is written in Swift, there is\u00a0no easy way to directly interact with the Heimdal Kerberos APIs on macOS in Swift. Because of that, an Objective-C bridging header is used to mix the two languages. Whenever you are asked for a password, it&#8217;s done via a secure text field and never written out anywhere. The password is then used with the Heimdal APIs and Objective-C to do <code>gss_aapl_initial_cred()<\/code> and get a TGT for the user. When changing passwords, the same process is followed using the Heimdal APIs to do <code>gss_aapl_change_password()<\/code>.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">The password is never piped to kinit or other Kerberos tools.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">When NoMAD is finished with your password, the variable is blanked to remove any trace from memory as quickly as possible.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Keychain Usage<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">If instructed, NoMAD will put the user&#8217;s password into the local Keychain. This is done through the use of <code>SecKeychainAddGenericPassword()<\/code> and other <code>SecKeychain<\/code> methods. The password is stored in the default keychain and will be removed if the user selects &#8220;Log Out&#8221; from the menu.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">If a password is present in the Keychain, NoMAD will use that password on launch to get Kerberos tickets. If the password is unable to authenticate the user, NoMAD deletes the password from the keychain so that it won&#8217;t ever accidentally lock you out by attempting to sign in with an incorrect password.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Active Directory Security<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">NoMAD\u00a0\u00a0does not require any security settings to be changed in Active Directory. NoMAD only uses SASL-authenticated binds when interacting with AD. By default, NoMAD uses the user&#8217;s Kerberos ticket to encrypt any LDAP traffic with AD. For more security, starting with version 1.0.5, NoMAD can be configured to use SSL in addition to LDAP connections to AD.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">User Space<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">NoMAD runs in user space, not as root. As such, it has no more privileges than the currently logged in user does. NoMAD&#8217;s functionality does not differ between admin and non-admin users.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Preferences<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">All of the application preferences can be set using configuration profiles either installed locally or from an MDM service. Setting the preferences in this way prevents a user from being able to change them.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Certificates<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">Similarly to passwords, NoMAD does not send a private key across the wire. The private key used for generating your CSR never leaves the Keychain. The process is done entirely within NoMAD using the <code>SecKeychain<\/code> and <code>SecCertificate<\/code> APIs.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">The private keys are marked as non-exportable by default; however, you can use a preference to change this.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">When sending the CSR to the Windows CA, Kerberos authentication is used, and the CSR is sent via SSL. Even though nothing in the CSR is sensitive, good data-in-motion hygiene is respected. The resulting signed public key is retrieved using Kerberos and SSL, and then matched up with the private key in the Keychain.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">SSL<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">The project in the repository has been set to Allow Arbitrary Loads for App Transport Security. You can change this flag in the Info tab of the project in Xcode.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">This setting allows for self-signed but specifically trusted certificates to be used, because many Windows CAs use a self-signed certificate root that all machines in the organization trust. In that situation, NoMAD is not able to get a x509 identity, even if the root certificate was explicitly trusted in the user&#8217;s Keychain.<\/p>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">You can remove this flag before compiling, but keep in mind that if you&#8217;re not using a publicly trusted certificate you&#8217;re likely to encounter issues when attempting to get a certificate for a user. If you don&#8217;t want to use the certificate functionality within NoMAD, then no other parts of NoMAD are impacted by changing SSL settings.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Network Connections<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">NoMAD does not listen for any incoming connections. All communications from NoMAD are outbound queries for DNS, LDAP, Kerberos and some web connections for certificates and other integrations that have been configured in the NoMAD preferences.<\/p>\n<h2 dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\"><strong style=\"font-size: 20px; line-height: 1.6em;\">Sandboxing<\/strong><\/h2>\n<p dir=\"auto\" style=\"font-size: 16px; line-height: 1.75em;\">Currently NoMAD is unable to be sandboxed on OS X\/macOS due to a few different features:<\/p>\n<ol dir=\"auto\">\n<li>The function being used to sleep the screen is not allowed inside a sandbox.<\/li>\n<li>If you want to sync the AD password with the local password, NoMAD needs to be able to change the local Keychain password. It does this using a private API <code>SecKeychainChangePassword()<\/code>. If\/when a public API becomes available that accomplishes the same task, we&#8217;ll move to that.<\/li>\n<li>The aforementioned App Transport Security flag.<\/li>\n<\/ol>\n","protected":false},"excerpt":{"rendered":"<p>As an application dealing with passwords and certificates, NoMAD takes security very seriously. Here are some notes to give you a better understanding of what NoMAD does with your secrets. General Thoughts NoMAD itself doesn&#8217;t do any of the heavy lifting as far as signing in to Active Directory and getting you SSO access. The [&hellip;]<\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"closed","ping_status":"closed","template":"","kbe_taxonomy":[18],"kbe_tags":[],"_links":{"self":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_knowledgebase\/501"}],"collection":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_knowledgebase"}],"about":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/types\/kbe_knowledgebase"}],"author":[{"embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/users\/3"}],"replies":[{"embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/comments?post=501"}],"version-history":[{"count":0,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_knowledgebase\/501\/revisions"}],"wp:attachment":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/media?parent=501"}],"wp:term":[{"taxonomy":"kbe_taxonomy","embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_taxonomy?post=501"},{"taxonomy":"kbe_tags","embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_tags?post=501"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}