{"id":328,"date":"2017-10-02T16:54:51","date_gmt":"2017-10-02T16:54:51","guid":{"rendered":"https:\/\/nomad.menu\/?post_type=kbe_knowledgebase&#038;p=328"},"modified":"2018-12-10T12:00:14","modified_gmt":"2018-12-10T18:00:14","slug":"nomad-shares-menu","status":"publish","type":"kbe_knowledgebase","link":"https:\/\/nomad.menu\/help\/nomad-shares-menu\/","title":{"rendered":"NoMAD Shares Menu"},"content":{"rendered":"<p>Starting with NoMAD v. 1.1, you can configure NoMAD to show users a collection of shares. This menu is configured via an additional configuration file, <em>menu.nomad.shares.plist<\/em>. This plist file can be rather complex, as you may be tempted to provided a number of shares, and then break out each share for only certain groups and then add variable substitution as well. Thus, we&#8217;d caution you to test this first before pushing it out to production.<\/p>\n<h2><strong>Where does it go?<\/strong><\/h2>\n<p>The preference domain is menu.nomad.shares. You can place an xml version of the file in <em>~\/Library\/Preferences\/menu.nomad.shares.plist<\/em> for testing purposes, although for long-term use it&#8217;s highly recommended to push this out via a configuration profile.<\/p>\n<h2><strong>How do you make it?<\/strong><\/h2>\n<p>There are 3 top-level objects in the file.<\/p>\n<p><em>Note: the use of [ ] around an object types denotes an array of that type of object.<\/em><\/p>\n<p>1. <em>Version<\/em> &#8211; This is the version number of the file format. Currently, the only version is 1.<\/p>\n<p>2. <em>HomeMount<\/em> &#8211; This is a dictionary of attributes for scenarios where the user&#8217;s home profile should be mounted:<\/p>\n<p><strong>Groups<\/strong> &#8211; [String] &#8211; Only mount the home for members of these AD groups.<br \/>\n<strong>Mount<\/strong> &#8211; Bool &#8211; Mount automatically or not.<br \/>\n<strong>Options<\/strong> &#8211; [String] &#8211; Array of mount options defined below.<\/p>\n<p>3. <em>Shares<\/em> &#8211; [Dictionary] &#8211; An array of dictionaries with each dictionary defining a mount point and associated attributes. The contents of each dictionary are as follows:<\/p>\n<p><strong>AutoMount<\/strong> &#8211; Bool &#8211; Is the share automatically mounted.<br \/>\n<strong>ConnectedOnly<\/strong> &#8211; Bool &#8211; Is the share only mounted when on the AD domain.<br \/>\n<strong>Groups<\/strong> &#8211; [String] &#8211; An array of AD group names. This share will only auto-mount for members of that group.<br \/>\n<strong>LocalMount<\/strong> &#8211; String &#8211; A local mount point.<br \/>\n<strong>Name<\/strong> &#8211; String &#8211; The name of the share as it will appear in the NoMAD menu item.<br \/>\n<strong>Options<\/strong> &#8211; [String] &#8211; Array of mount options defined below.<br \/>\n<strong>URL<\/strong> &#8211; String &#8211; The actual URL of the mount point in the form of &#8220;smb:\/\/dc1.nomad.test\/Homes&#8221;.<\/p>\n<h2><strong>Options<\/strong><\/h2>\n<p>First off, huge thanks to @frogor for figuring these out. Note that most of these are probably neither very safe, nor useful. Please use at your own risk. The primary ones that most admins will care about are MNT_RDONLY, MNT_DONTBROWSE and MNT_NOEXEC.<br \/>\n<code><br \/>\n\"MNT_RDONLY\" - Mounts the share read only<br \/>\n\"MNT_SYNCHRONOUS\" - All I\/O to the file system should be done synchronously.<br \/>\n\"MNT_NOEXEC\" - Prohibts execution of code from the share<br \/>\n\"MNT_NOSUID\" - Do not allow set-user-identifier or set-group-identifier bits to take effect.<br \/>\n\"MNT_NODEV\" - Do not interpret character or block special devices on the file system.<br \/>\n\"MNT_UNION\" - Causes the namespace to appear as the union of directories of the mounted filesystem with corre-<br \/>\nsponding directories in the underlying filesystem.<br \/>\n\"MNT_ASYNC\" - All I\/O to the file system should be done asynchronously.<br \/>\n\"MNT_CPROTECT\" -<br \/>\n\"MNT_EXPORTED\" - Filesystem is exported<br \/>\n\"MNT_QUARANTINE\" - File system is quarantined<br \/>\n\"MNT_LOCAL\" - File system is stored locally<br \/>\n\"MNT_QUOTA\" - Quotas are enabled<br \/>\n\"MNT_ROOTFS\" - Identifies the root filesystem<br \/>\n\"MNT_DOVOLFS\" - Filesystem supports volfs (deprecated flag in Mac OS X 10.5)<br \/>\n\"MNT_DONTBROWSE\" - Does not display the share in the Finder<br \/>\n\"MNT_IGNORE_OWNERSHIP\" - Ignore ownership information on file system objects<br \/>\n\"MNT_AUTOMOUNTED\" - Set flags on the mountpoint to indicate that the volume has been mounted by the automounter.<br \/>\n\"MNT_JOURNALED\" - Mount filesystem journaled<br \/>\n\"MNT_NOUSERXATTR\" - User extended attributes not allowed<br \/>\n\"MNT_DEFWRITE\" - Filesystem should defer writes<br \/>\n\"MNT_MULTILABEL\" - Support for individual labels<br \/>\n\"MNT_NOATIME\" - Do not update the file access time when reading from a file.<br \/>\n<\/code><\/p>\n<h2><strong>Variable Substitution<\/strong><\/h2>\n<p>For the URLs, you can use variable substitution to allow for custom mounts without having to create even more XML. NoMAD understands <em>&lt;&lt;domain&gt;&gt;, &lt;&lt;fullname&gt;&gt;,&lt;&lt;serial&gt;&gt;,&lt;&lt;shortname&gt;&gt;,&lt;&lt;upn&gt;&gt; <\/em>and<em> &lt;&lt;email&gt;&gt;<\/em>.<\/p>\n<p>Using any of these in a URL will swap out that variable for the corresponding value from the users&#8217;s AD account.<\/p>\n<h2><strong>Viewing the Preference File<\/strong><\/h2>\n<p>This is what you will see if viewing the file via the defaults command:<\/p>\n<p><code>{ HomeMount = {<br \/>\nGroups = ( \"Domain Users\" );<br \/>\nMount = false;<br \/>\nOptions = ( );<br \/>\n};<br \/>\nShares = (<br \/>\n{ AutoMount = false;<br \/>\nConnectedOnly = true;<br \/>\nGroups = ( \"Share Mounter Test\" );<br \/>\nLocalMount = \"\";<br \/>\nName = \"File Server 2\";<br \/>\nOptions = ( );<br \/>\nURL = \"smb:\/\/dc2.eng.nomad.test\/Files\";<br \/>\n},<br \/>\n{ AutoMount = true;<br \/>\nConnectedOnly = true;<br \/>\nGroups = ( );<br \/>\nLocalMount = \"\";<br \/>\nName = \"Home Shares\";<br \/>\nOptions = ( );<br \/>\nURL = \"smb:\/\/dc1.nomad.test\/Homes\";<br \/>\n},<br \/>\n);<br \/>\nVersion = \"1\";<br \/>\n}<\/code><\/p>\n<p>And here is an XML version of the same:<\/p>\n<pre>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\r\n&lt;!DOCTYPE plist PUBLIC \"-\/\/Apple\/\/DTD PLIST 1.0\/\/EN\" \"http:\/\/www.apple.com\/DTDs\/PropertyList-1.0.dtd\"&gt;\r\n&lt;plist version=\"1.0\"&gt;\r\n&lt;dict&gt;\r\n     &lt;key&gt;HomeMount&lt;\/key&gt;\r\n     &lt;dict&gt;\r\n          &lt;key&gt;Groups&lt;\/key&gt;\r\n          &lt;array&gt;\r\n               &lt;string&gt;All&lt;\/string&gt;\r\n          &lt;\/array&gt;\r\n          &lt;key&gt;Mount&lt;\/key&gt;\r\n          &lt;true\/&gt;\r\n          &lt;key&gt;Options&lt;\/key&gt;\r\n          &lt;array\/&gt;\r\n     &lt;\/dict&gt;\r\n     &lt;key&gt;Shares&lt;\/key&gt;\r\n     &lt;array&gt;\r\n          &lt;dict&gt;\r\n               &lt;key&gt;AutoMount&lt;\/key&gt;\r\n               &lt;true\/&gt;\r\n               &lt;key&gt;ConnectedOnly&lt;\/key&gt;\r\n               &lt;true\/&gt;\r\n               &lt;key&gt;Groups&lt;\/key&gt;\r\n               &lt;array\/&gt;\r\n               &lt;key&gt;LocalMount&lt;\/key&gt;\r\n               &lt;string&gt;&lt;\/string&gt;\r\n               &lt;key&gt;Name&lt;\/key&gt;\r\n               &lt;string&gt;DC1 files&lt;\/string&gt;\r\n               &lt;key&gt;Options&lt;\/key&gt;\r\n               &lt;array\/&gt;\r\n               &lt;key&gt;URL&lt;\/key&gt;\r\n               &lt;string&gt;smb:\/\/dc1.nomad.test\/Files&lt;\/string&gt;\r\n          &lt;\/dict&gt;\r\n          &lt;dict&gt;\r\n               &lt;key&gt;AutoMount&lt;\/key&gt;\r\n               &lt;true\/&gt;\r\n               &lt;key&gt;ConnectedOnly&lt;\/key&gt;\r\n               &lt;true\/&gt;\r\n               &lt;key&gt;Groups&lt;\/key&gt;\r\n               &lt;array\/&gt;\r\n               &lt;key&gt;LocalMount&lt;\/key&gt;\r\n               &lt;string&gt;&lt;\/string&gt;\r\n               &lt;key&gt;Name&lt;\/key&gt;\r\n               &lt;string&gt;Home Shares&lt;\/string&gt;\r\n               &lt;key&gt;Options&lt;\/key&gt;\r\n               &lt;array\/&gt;\r\n               &lt;key&gt;URL&lt;\/key&gt;\r\n               &lt;string&gt;smb:\/\/dc1.nomad.test\/Homes\/&amp;lt;&amp;lt;shortname&amp;gt;&amp;gt;&lt;\/string&gt;\r\n          &lt;\/dict&gt;\r\n     &lt;\/array&gt;\r\n     &lt;key&gt;Version&lt;\/key&gt;\r\n     &lt;string&gt;1&lt;\/string&gt;\r\n&lt;\/dict&gt;\r\n&lt;\/plist&gt;<\/pre>\n","protected":false},"excerpt":{"rendered":"<p>Starting with NoMAD v. 1.1, you can configure NoMAD to show users a collection of shares. This menu is configured via an additional configuration file, menu.nomad.shares.plist. This plist file can be rather complex, as you may be tempted to provided a number of shares, and then break out each share for only certain groups and [&hellip;]<\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"closed","ping_status":"closed","template":"","kbe_taxonomy":[25],"kbe_tags":[],"_links":{"self":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_knowledgebase\/328"}],"collection":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_knowledgebase"}],"about":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/types\/kbe_knowledgebase"}],"author":[{"embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/users\/3"}],"replies":[{"embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/comments?post=328"}],"version-history":[{"count":0,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_knowledgebase\/328\/revisions"}],"wp:attachment":[{"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/media?parent=328"}],"wp:term":[{"taxonomy":"kbe_taxonomy","embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_taxonomy?post=328"},{"taxonomy":"kbe_tags","embeddable":true,"href":"https:\/\/nomad.menu\/wp-json\/wp\/v2\/kbe_tags?post=328"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}